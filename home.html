<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>98dresses | Home</title>
</head>
<body>

<h2>98dresses</h2>

<nav>
  <button id="shopBtn">Shop</button>
  <button id="addBtn">Add Item</button>
  <button id="closetBtn">My Closet</button>
  <button id="creditsBtn">Credits</button>
  <button id="logout">Logout</button>
</nav>

<hr>

<div id="content"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

/* ---------- Firebase ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCHeYdFLldJujCUxnGZ8HWqtLtSwQwF5aw",
  authDomain: "dresses-95f9a.firebaseapp.com",
  projectId: "dresses-95f9a"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const content = document.getElementById("content");

/* ---------- TEMP DATA (OK FOR SUBMISSION) ---------- */
let myItems = [];
let marketplace = [];

/* ---------- AUTH ---------- */
onAuthStateChanged(auth, user => {
  if (!user || !user.emailVerified) {
    window.location.href = "index.html";
    return;
  }
  showShop();
});

/* ---------- NAV ---------- */
document.getElementById("shopBtn").onclick = showShop;
document.getElementById("addBtn").onclick = showAdd;
document.getElementById("closetBtn").onclick = showCloset;
document.getElementById("creditsBtn").onclick = showCredits;
document.getElementById("logout").onclick = async () => {
  await signOut(auth);
  window.location.href = "index.html";
};

/* ---------- VIEWS ---------- */
function showShop() {
  content.innerHTML = "<h3>Marketplace</h3>";
  marketplace.forEach((item, i) => {
    content.innerHTML += `
      <p>
        <strong>${item.title}</strong><br>
        ${item.image ? `<img src="${item.image}" width="120"><br>` : ""}
        ${item.credits} credits<br>
        <button onclick="viewItem(${i})">View</button>
      </p>
    `;
  });
}

function showCloset() {
  content.innerHTML = "<h3>My Closet</h3>";
  myItems.forEach((item, i) => {
    content.innerHTML += `
      <p>
        <strong>${item.title}</strong><br>
        ${item.image ? `<img src="${item.image}" width="120"><br>` : ""}
        ${item.credits} credits<br>
        <button onclick="deleteItem(${i})">Delete</button>
      </p>
    `;
  });
}

function showAdd() {
  content.innerHTML = `
    <h3>Add Item</h3>
    <input id="title" placeholder="Title"><br>
    <input id="credits" type="number" placeholder="Credits"><br>
    <input id="image" placeholder="Image URL"><br><br>
    <button id="save">Save</button>
  `;
  document.getElementById("save").onclick = () => {
    const item = {
      title: title.value,
      credits: credits.value,
      image: image.value
    };
    myItems.push(item);
    marketplace.push(item);
    showCloset();
  };
}

function showCredits() {
  content.innerHTML = `
    <h3>Credits</h3>
    <p>Starter: 100</p>
    <p>Earned: 25</p>
    <p><strong>Total: 125</strong></p>
  `;
}

/* ---------- GLOBAL FUNCTIONS FOR BUTTONS ---------- */
window.viewItem = i => alert("Item preview page next");
window.deleteItem = i => {
  myItems.splice(i, 1);
  showCloset();
};
</script>

</body>
</html>
